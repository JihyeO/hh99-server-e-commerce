## 부하 테스트 계획서

### 1. 테스트 대상

상품 주문 API

📌 선정 이유

- 시스템 내에서 실시간 데이터 정합성 유지가 가장 중요한 핵심 기능
- 주문 시 다양한 외부/내부 자원(Redis, DB 등)을 사용하는 복잡한 트랜잭션 포함
- 단일 API에서 재고 차감, 사용자 잔액 확인, 결제 처리, 주문 기록 저장 등의 복합 작업이 동시에 수행됨
- 특히 프로모션, 라이브 커머스 등에서 순간적인 주문 폭주가 발생할 수 있으므로 동시성 제어, DB 성능, 락 처리의 안전성 검증이 필요

### 2. 테스트 목적

- 시스템이 예상 주문량 및 순간 트래픽 폭주를 문제 없이 처리할 수 있는지 검증
- 다량의 동시 요청이 발생할 때, 다음과 같은 항목을 측정 및 확인

| 항목                          | 목적                                |
| ----------------------------- | ----------------------------------- |
| TPS (Transactions Per Second) | 시스템 처리량 확인                  |
| 평균/중간/최대 응답시간       | 성능의 일관성 확인                  |
| 실패율                        | 임계 상황에서의 오류 발생 여부 확인 |
| 락 경합, DeadLock 발생 여부   | 동시성 처리 안정성 검증             |
| Slow Query 탐지               | DB 병목 지점 확인                   |

### 3. 테스트 시나리오

#### 3-1. 동시성 / 락 병목 테스트

- 시나리오 A: 동일 사용자/상품에 대한 동시 주문 요청

  - 목표: Redis Lock, DB PESSIMISTIC_LOCK 처리의 안정성 확인
  - 측정: 응답 시간, DeadLock 발생 여부, 실패율

- 시나리오 B: 동일 상품 재고 초과 주문

  - 목표: 재고 부족 상황에서 초과 주문이 어떻게 처리되는지 검증
  - 측정: 예외 처리 정확성, 롤백 동작 여부

#### 3-2. DB 성능 /쿼리 병목 테스트

- 시나리오 C: 대량 주문 요청 시 DB 조회 성능 측정

  - 대상: Product, User, Order 테이블
  - 측정: 쿼리 수행 시간, 인덱스 사용 여부, 락 유지 시간

- 시나리오 D: 잔액/재고 차감 로직의 부하
  - 목표: 잔액 및 재고 업데이트 트랜잭션이 다른 트랜잭션에 미치는 영향 파악
  - 측정: 차감 쿼리의 응답 시간 및 DB 락 전파 여부

### 4. 테스트 도구

| 항목        | 내용                                                                                                                                                   |
| ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 테스트 도구 | **k6**                                                                                                                                                 |
| 선정 이유   | - 가장 빠르고 간편하게 부하 테스트를 시작할 수 있음<br> - 설치 및 실행이 간단함<br> - 코드(JavaScript) 기반으로 시나리오 작성 가능, 버전 관리에 유리함 |
| 요청 수     | 최대 초당 500~1000 TPS까지 점진적으로 증가                                                                                                             |
| 테스트 방식 | 시나리오별 부하 프로파일 설정 (예: 100명 동시 주문, 10분간 지속 등)                                                                                    |

### 5. 기대 효과

- 사전에 병목/락/데이터 정합성 이슈를 발견함으로써, 장애 예방 및 SLA 유지
- 라이브 이벤트, 대규모 마케팅 등 고트래픽 상황에도 안정적인 서비스 제공 가능성 확보
- 개발 및 운영 조직 간의 병목 개선점 공유로 성능 개선 기반 마련
